# 逆向工程与软件安全大作业实验报告

## 1. 实验目的

综合应用 `Dll注入技术` 和 `IATHook`/`APIHook` 更改特定API的功能。

## 2. 实验内容

1) 通过Dll注入修改 `WriteFile` 函数更改 `Notepad.exe` 文件中保存的内容；

2) 向 `calc.exe` 进程注入dll文件，钩取IAT的 `user32.SetWindowTextW()` 函数的API地址，实现显示大写中文数字的计算器。

## 3. 实验原理

本次实验要求通过注入DLL文件来勾取某个API，DLL文件注入目标进程后，修改IAT来改变进程中调用的特定API的功能。

这种方法的优点是工作原理和实现较为简单，只需要在用户的DLL文件中重新定义API，再注入目标进程即可。但是相应的缺点是，如果要hook的API是动态加载的DLL文件，这种方法将无法实现。


## 4. Part II 中文计算器

### 4.1 选取目标API

我们在之前的课程上使用Windbg调试，但是这里我们从初学者的角度出发，如何确定要勾取的API？这里我们使用PEView查看所有导入的API，并发现了几个较为相关的函数。

![](img/findapi.png)

根据微软文档

```cpp
BOOL SetWindowTextW(
  HWND    hWnd,
  LPCWSTR lpString
);
```

```cpp
BOOL SetDlgItemTextW(
  HWND    hDlg,
  int     nIDDlgItem,
  LPCWSTR lpString
);
```